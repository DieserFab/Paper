From 731749cb1f6e63870e8ec99aca17fa782ee70150 Mon Sep 17 00:00:00 2001
From: DieserFab <fabiankbullik@gmail.com>
Date: Tue, 28 Jul 2020 00:36:39 +0200
Subject: [PATCH] Added Certain Potion Events


diff --git a/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectAddEvent.java b/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectAddEvent.java
new file mode 100644
index 00000000..01882bb2
--- /dev/null
+++ b/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectAddEvent.java
@@ -0,0 +1,77 @@
+package de.dieserfab.fabspigot.event.entity;
+
+import org.bukkit.entity.LivingEntity;
+import org.bukkit.event.Cancellable;
+import org.bukkit.event.HandlerList;
+import org.bukkit.potion.PotionEffect;
+
+/**
+ * Called when a potion effect is applied to an entity, or an existing effect is extended or upgraded
+ */
+public class PotionEffectAddEvent extends PotionEffectEvent implements Cancellable {
+
+    private static final HandlerList handlers = new HandlerList();
+
+    private boolean cancelled;
+    protected final EffectCause effectCause;
+
+    public PotionEffectAddEvent(LivingEntity entity, PotionEffect effect, EffectCause effectCause) {
+        super(entity, effect);
+        this.effectCause = effectCause;
+    }
+
+    public EffectCause getCause() {
+        return effectCause;
+    }
+
+    @Override
+    public boolean isCancelled() {
+        return cancelled;
+    }
+
+    @Override
+    public void setCancelled(boolean cancel) {
+        this.cancelled = cancel;
+    }
+
+    @Override
+    public HandlerList getHandlers() {
+        return handlers;
+    }
+
+    public static HandlerList getHandlerList() {
+        return handlers;
+    }
+
+    /**
+     * The cause of receiving a potion effect
+     */
+    public enum EffectCause {
+
+        /**
+         * Indicates the effect was caused by the proximity of a potion effect splash
+         */
+        POTION_SPLASH,
+        /**
+         * Indicates the effect was caused by the proximity of a beacon
+         */
+        BEACON,
+        /**
+         * Indicates the effect was caused by damage from a wither skeleton
+         */
+        WITHER_SKELETON,
+        /**
+         * Indicates the effect was caused by damage from a wither skull
+         */
+        WITHER_SKULL,
+        /**
+         * Indicates the effect was caused by a plugin
+         */
+        PLUGIN,
+        /**
+         * Indicates the effect was caused by an event not covered by
+         * this enum
+         */
+        UNKNOWN
+    }
+}
\ No newline at end of file
diff --git a/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectEvent.java b/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectEvent.java
new file mode 100644
index 00000000..0046d9f4
--- /dev/null
+++ b/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectEvent.java
@@ -0,0 +1,24 @@
+package de.dieserfab.fabspigot.event.entity;
+
+import org.bukkit.entity.LivingEntity;
+import org.bukkit.event.entity.EntityEvent;
+import org.bukkit.potion.PotionEffect;
+
+public abstract class PotionEffectEvent extends EntityEvent {
+
+    private final PotionEffect effect;
+
+    public PotionEffectEvent(LivingEntity what, PotionEffect effect) {
+        super(what);
+        this.effect = effect;
+    }
+
+    @Override
+    public LivingEntity getEntity() {
+        return (LivingEntity) super.getEntity();
+    }
+
+    public PotionEffect getEffect() {
+        return effect;
+    }
+}
\ No newline at end of file
diff --git a/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectExpireEvent.java b/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectExpireEvent.java
new file mode 100644
index 00000000..22c997a3
--- /dev/null
+++ b/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectExpireEvent.java
@@ -0,0 +1,45 @@
+package de.dieserfab.fabspigot.event.entity;
+
+import org.bukkit.entity.LivingEntity;
+import org.bukkit.potion.PotionEffect;
+
+/**
+ * Called when a potion effect on an entity runs out. Cancelling the event extends
+ * the effect with a practically infinite duration. The new duration can also be set
+ * explicitly by calling {@link #setDuration}.
+ *
+ * Handlers of {@link PotionEffectRemoveEvent} will also receive this event.
+ */
+public class PotionEffectExpireEvent extends PotionEffectRemoveEvent {
+
+    private int duration = 0;
+
+    public PotionEffectExpireEvent(LivingEntity entity, PotionEffect effect) {
+        super(entity, effect);
+    }
+
+    /**
+     * Get the new duration for the potion effect. This is initially 0.
+     */
+    public int getDuration() {
+        return duration;
+    }
+
+    /**
+     * Set a new duration for the potion effect. Passing 0 to this method un-cancels
+     * the event, and passing anything above 0 cancels it.
+     */
+    public void setDuration(int duration) {
+        this.duration = Math.max(0, duration);
+    }
+
+    @Override
+    public boolean isCancelled() {
+        return duration > 0;
+    }
+
+    @Override
+    public void setCancelled(boolean cancel) {
+        this.duration = cancel ? Integer.MAX_VALUE : 0;
+    }
+}
\ No newline at end of file
diff --git a/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectExtendEvent.java b/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectExtendEvent.java
new file mode 100644
index 00000000..c826e28d
--- /dev/null
+++ b/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectExtendEvent.java
@@ -0,0 +1,26 @@
+package de.dieserfab.fabspigot.event.entity;
+
+import org.bukkit.entity.LivingEntity;
+import org.bukkit.potion.PotionEffect;
+
+/**
+ * Called when an entity's active potion effect is extended or upgraded.
+ *
+ * Handlers of {@link PotionEffectAddEvent} will also receive this event.
+ */
+public class PotionEffectExtendEvent extends PotionEffectAddEvent {
+
+    private final PotionEffect oldEffect;
+
+    public PotionEffectExtendEvent(LivingEntity entity, PotionEffect effect, PotionEffect oldEffect, EffectCause effectCause) {
+        super(entity, effect, effectCause);
+        this.oldEffect = oldEffect;
+    }
+
+    /**
+     * Get the state of the potion effect prior to the change
+     */
+    public PotionEffect getOldEffect() {
+        return oldEffect;
+    }
+}
\ No newline at end of file
diff --git a/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectRemoveEvent.java b/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectRemoveEvent.java
new file mode 100644
index 00000000..c963f14a
--- /dev/null
+++ b/src/main/java/de/dieserfab/fabspigot/event/entity/PotionEffectRemoveEvent.java
@@ -0,0 +1,39 @@
+package de.dieserfab.fabspigot.event.entity;
+
+import org.bukkit.entity.LivingEntity;
+import org.bukkit.event.Cancellable;
+import org.bukkit.event.HandlerList;
+import org.bukkit.potion.PotionEffect;
+
+/**
+ * Called when a potion effect is removed from an entity for whatever reason
+ */
+public class PotionEffectRemoveEvent extends PotionEffectEvent implements Cancellable {
+
+    private static final HandlerList handlers = new HandlerList();
+
+    private boolean cancelled;
+
+    public PotionEffectRemoveEvent(LivingEntity entity, PotionEffect effect) {
+        super(entity, effect);
+    }
+
+    @Override
+    public boolean isCancelled() {
+        return cancelled;
+    }
+
+    @Override
+    public void setCancelled(boolean cancel) {
+        this.cancelled = cancel;
+    }
+
+    @Override
+    public HandlerList getHandlers() {
+        return handlers;
+    }
+
+    public static HandlerList getHandlerList() {
+        return handlers;
+    }
+}
\ No newline at end of file
-- 
2.26.2.windows.1

